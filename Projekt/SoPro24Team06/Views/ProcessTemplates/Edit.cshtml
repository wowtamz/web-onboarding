@using Microsoft.AspNetCore.Identity
@model SoPro24Team06.ViewModels.ProcessTemplateViewModel
@{
  //-------------------------
  // Author: Kevin Tornquist
  //-------------------------

  ViewData["Title"] = "Prozess bearbeiten";

  List<ApplicationUser> Users = ViewData["Users"] as List<ApplicationUser>;
  List<ProcessTemplate> ProcessTemplates = ViewData["ProcessTemplates"] as List<ProcessTemplate>;
  List<AssignmentTemplate> AssignmentTemplates = ViewData["AssignmentTemplates"] as List<AssignmentTemplate>;
  List<Contract> Contracts = ViewData["Contracts"] as List<Contract>;
  List<Department> Departments = ViewData["Departments"] as List<Department>;
  List<ApplicationRole> Roles = ViewData["Roles"] as List<ApplicationRole>;
}

<form asp-controller="ProcessTemplate" method="post">
  <input type="hidden" asp-for="Id" />
  <!-- Create: Titel -->
  <fieldset style="margin-top: 12px">
    <legend>Prozesstitel</legend>
    <input class="form-control" type="text" asp-for="Title" />
    <span asp-validation-for="Title" class="text-danger"></span>
  </fieldset>
  <!-- Create: Titel -->

  <!-- Create: Beschreibung -->
  <fieldset style="margin-top: 12px">
    <legend>Beschreibung</legend>
    <textarea class="form-control" asp-for="Description"></textarea>
    <span asp-validation-for="Description" class="text-danger"></span>
  </fieldset>
  <!-- Create: Beschreibung -->

  <!-- Create: Vertragstyp -->
  <fieldset style="margin-top: 12px">
    <legend>Vertragstyp</legend>
    @if (Contracts == null || Contracts.Count == 0)
    {
      <p>Keine Verträge vorhanden</p>
    }
    else
    {
      <select class="form-select" asp-for="ContractOfRefWorkerId">
        @foreach (var contract in Contracts)
        {
          <option value="@contract.Id">@contract.Label</option>
        }
      </select>
      <span asp-validation-for="ContractOfRefWorkerId" class="text-danger"></span>
    }
  </fieldset>
  <!-- Create: Vertragstyp -->

  <!-- Create: Rollen -->
  <fieldset style="margin-top: 12px">
    <legend>Rolle</legend>
    @if (Roles == null || Roles.Count == 0)
    {
      <p>Keine Rollen vorhanden</p>
    }
    else
    {
      <select asp-for="RolesWithAccess" class="form-control" multiple="multiple" id="SelectedRoles">
        @foreach (var role in Roles)
        {
          <option value="@role.Name">@role</option>
        }
      </select>
      <span asp-validation-for="RolesWithAccess" class="text-danger"></span>
    }
  </fieldset>
  <!-- Create: Rollen -->

  <!-- Create: Abteilung -->
  <fieldset style="margin-top: 12px">
    <legend>Abteilung</legend>
    @if (Departments == null || Departments.Count == 0)
    {
      <p>Keine Abteilungen vorhanden</p>
    }
    else
    {

      <select class="form-select" asp-for="DepartmentOfRefWorkerId">
        @foreach (var department in Departments)
        {
          <option value="@department.Id">@department.Name</option>
        }
      </select>
      <span asp-validation-for="DepartmentOfRefWorkerId" class="text-danger"></span>
    }
  </fieldset>
  <!-- Create: Abteilung -->

  <!-- Start: Aufgaben Select -->
  <div class="form-group" style="margin-top: 12px">
    <legend>Aufgaben</legend>
    @if (AssignmentTemplates == null || AssignmentTemplates.Count == 0)
    {
      <p>Keine Aufgaben vorhanden</p>
    }
    else
    {

      <select id="selectedAssignmentTemplate" asp-for="SelectedAssignmentTemplateIds" class="form-control"
        multiple="multiple">
        @foreach (var template in AssignmentTemplates)
        {
          <option value="@template.Id">@template.Title</option>
        }
      </select>
      <span asp-validation-for="SelectedAssignmentTemplateIds" class="text-danger"></span>
    }
  </div>
  <!-- Ende: Aufgaben Select -->
  <div style="margin-top: 36px;">
    <button asp-action="Edit" class="btn" type="submit" style="background-color: var(--lemming); color: white;">
      Bearbeiten
    </button>
    <button asp-action="RedirectAssignmentTemplateCreate" type="submit" class="btn "
      style="background-color: var(--ash); color: white;">
      Weitere Aufgaben erstellen
    </button>
  </div>
</form>

@section Scripts {
  <partial name="_ValidationScriptsPartial" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
  <script>
    $(document).ready(function () {
      $('#SelectedRoles').select2({
        placeholder: "Wählen Sie Rollen aus",
        allowClear: true
      });
      $('#selectedAssignmentTemplate').select2({
        placeholder: "Fügen Sie Aufgaben hinzu",
        allowClear: true
      });
    });
  </script>
}